<!DOCTYPE html>
<html lang="en">
<head>
    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            const timezoneField = document.getElementById('timezone');
            const userTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            timezoneField.value = userTimezone
            const remindAtField = document.getElementById('remind_at');
            if(remindAtField.value){
                const remindAtUTC = new Date(remindAtField.value + 'Z');
            const remindAtLocal = new Date(remindAtUTC.toLocaleString('en-US', { timeZone: userTimezone }));
            const year = remindAtLocal.getFullYear();
            const month = String(remindAtLocal.getMonth() + 1).padStart(2, '0');
            const day = String(remindAtLocal.getDate()).padStart(2, '0');
            const hours = String(remindAtLocal.getHours()).padStart(2, '0');
            const minutes = String(remindAtLocal.getMinutes()).padStart(2, '0');
            remindAtField.value = `${year}-${month}-${day}T${hours}:${minutes}`;
            }
        });
    </script>
</head>
<body>
<h2>Update Task</h2>

<form method="post">
    {% csrf_token %}
    <label for="title">Title:</label>
    <input type="text" id="title" name="title" value="{{ task.title }}">
    <br>
    <label for="description">Description:</label>
    <textarea id="description" name="description">{{ task.description }}</textarea>
    <br>
    <label for="due_date">Due Date:</label>
    <input type="date" id="due_date" name="due_date" value="{{ task.due_date|date:'Y-m-d' }}">
    <br>
    <label for="completed">Completed:</label>
    <input type="checkbox" id="completed" name="completed" {% if task.completed %}checked{% endif %}>
    <br>
    <label for="category">Category:</label>
    <select id="category" name="category">
        {% for category in categories %}
            <option value="{{ category.id }}" {% if task.category.id == category.id %}selected{% endif %}>
                {{ category.name }}
            </option>
        {% endfor %}
    </select>
    <br>
    <label for="remind_at">Reminder:</label>
    <input type="datetime-local" id="remind_at" name="remind_at" value="{{ reminder.remind_at|date:'Y-m-d\\TH:i' }}">
    <input type="hidden" id="timezone" name="timezone">
    <br>
    <button type="submit">Update</button>
</form>
